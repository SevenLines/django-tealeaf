// Generated by CoffeeScript 1.7.1
(function() {
  var active_btn_style, add_group_form_ajaxing, add_group_form_selector, add_student_form_ajaxing, add_student_form_selector, bind_submit_links, clear_items, cookie_discp_id, cookie_group_id, cookie_year, group_content_selector, group_item, group_item_forms_ajaxing, group_submit_links, groups_nav_ajaxing, remove_group_form_ajaxing, remove_group_form_selector, restore_last_group, restore_last_year, set_years_events, student_content_selector, students_form_ajaxing, update_group_form_ajaxing, update_group_form_selector, year_selector_form;

  cookie_group_id = function() {
    return $.cookie('group_id');
  };

  cookie_discp_id = function() {
    return $.cookie('discipline_id');
  };

  cookie_year = function() {
    return $.cookie('year');
  };

  add_student_form_selector = "form#add_student";

  add_group_form_selector = "#groups-nav form#add_group";

  remove_group_form_selector = "#groups-nav form.remove";

  update_group_form_selector = "#groups-nav form.update";

  group_submit_links = "#groups-nav .submit-link";

  year_selector_form = "form#year_selector";

  student_content_selector = "#group-students .content";

  group_content_selector = "#groups-content";

  group_item = "#groups-nav form.item";

  active_btn_style = 'btn-primary';

  clear_items = function() {
    return $(group_submit_links).removeClass(active_btn_style);
  };

  restore_last_year = function() {
    if (cookie_year()) {
      $("" + year_selector_form + " select option").filter(function() {
        return $(this).text() === cookie_year();
      }).attr('selected', true);
      return $(year_selector_form).submit();
    }
  };

  bind_submit_links = function() {
    return $(group_submit_links).click(function() {
      return $(this).children('form').submit();
    });
  };

  restore_last_group = function() {
    if (cookie_group_id()) {
      return $(group_item).find("input[name='group_id'][value='" + (cookie_group_id()) + "']").siblings('[type=submit]')[0].click();
    }
  };

  students_form_ajaxing = function() {
    add_student_form_ajaxing();
    return $("#group-students .content form.ajaxed").ajaxForm({
      target: student_content_selector,
      success: function(response, status, xhr, $form) {
        return students_form_ajaxing();
      }
    });
  };

  groups_nav_ajaxing = function() {
    group_item_forms_ajaxing();
    add_group_form_ajaxing();
    remove_group_form_ajaxing();
    update_group_form_ajaxing();
    return restore_last_group();
  };

  group_item_forms_ajaxing = function() {
    bind_submit_links();
    return $(group_item).ajaxForm({
      target: student_content_selector,
      success: function(response, status, xhr, $form) {
        var sbm;
        clear_items();
        $(add_student_form_selector).children("input[name='group_id']").attr('value', cookie_group_id());
        sbm = $form.closest(group_submit_links);
        $(sbm).addClass(active_btn_style);
        return students_form_ajaxing();
      }
    });
  };

  remove_group_form_ajaxing = function() {
    return $(remove_group_form_selector).ajaxForm({
      target: group_content_selector,
      success: function(response, status, xhr, $form) {
        return groups_nav_ajaxing();
      }
    });
  };

  add_group_form_ajaxing = function() {
    return $(add_group_form_selector).ajaxForm({
      target: group_content_selector,
      success: function(response, status, xhr, $form) {
        return groups_nav_ajaxing();
      }
    });
  };

  update_group_form_ajaxing = function() {
    return $(update_group_form_selector).ajaxForm({
      target: group_content_selector,
      success: function(response, status, xhr, $form) {
        return groups_nav_ajaxing();
      }
    });
  };

  add_student_form_ajaxing = function() {
    return $(add_student_form_selector).ajaxForm({
      target: student_content_selector,
      success: function(response, status, xhr, $form) {
        alert($(add_student_form_selector).size());
        $(add_student_form_selector).find("input[type=text]").val('');
        $($(add_student_form_selector).find("input[type=text]")[0]).focus();
        return students_form_ajaxing();
      }
    });
  };

  set_years_events = function() {
    $("" + year_selector_form + " select").on('change', function() {
      return $(year_selector_form).submit();
    });
    $(year_selector_form).ajaxForm({
      target: group_content_selector,
      success: function(response, status, xhr, $form) {
        return groups_nav_ajaxing();
      }
    });
    return restore_last_year();
  };

  window.set_years_events = set_years_events;

}).call(this);
